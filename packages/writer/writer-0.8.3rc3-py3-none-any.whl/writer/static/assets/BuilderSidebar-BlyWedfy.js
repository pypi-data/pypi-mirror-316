import{d as M,ap as _e,aq as ve,o as a,e as m,f as n,m as j,a5 as ge,D as he,_ as A,i as x,a as E,r as L,c as _,ax as ye,ay as Z,w as ee,b as $,n as q,F as I,s as X,t as F,Z as te,Q as O,au as we,W as G,K as S,M as J,x as ke,as as be,l as Ce,v as Ie,O as oe,u as Se,y as ae,z as ne,q as Y}from"./index-Bu3rAGYU.js";const Te={class:"BuilderSidebarPanel"},Be={class:"inputContainer"},De={class:"main"},$e=M({__name:"BuilderSidebarPanel",props:_e({placeholder:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u){const v=ve(u,"modelValue");return(s,p)=>(a(),m("div",Te,[n("div",Be,[j(ge,{modelValue:v.value,"onUpdate:modelValue":p[0]||(p[0]=i=>v.value=i),class:"searchInput","left-icon":"search","data-automation-action":"search",placeholder:s.placeholder},null,8,["modelValue","placeholder"])]),n("div",De,[he(s.$slots,"default",{},void 0,!0)])]))}}),se=A($e,[["__scopeId","data-v-9ab52e2b"]]),xe={class:"header"},Ee={class:"tools"},Ve=["data-writer-tooltip","data-component-type","onDragstart"],qe=["alt","src","onError"],Le={class:"name"},Me=M({__name:"BuilderSidebarToolkit",setup(u){const v=x(E.core),s=x(E.builderManager),{removeInsertionCandidacy:p}=te(v),i=L(""),b=L({}),V=["Layout","Content","Input","Embed","Writer","Logic","Other"],w=_(()=>s.getMode()=="workflows"?"workflows":"core"),y=_(()=>{const c=V.map(d=>[d,D(d)]).filter(([d,g])=>g.length>0);return Object.fromEntries(c)}),B=_(()=>w.value=="core"?"Core toolkit":w.value=="workflows"?"Workflows toolkit":"Toolkit");function D(c){const g=ye().filter(e=>{const h=Z(e);return!(h.category!=c||!h.toolkit&&w.value!=="core"||h.toolkit&&h.toolkit!==w.value)}).map(e=>{const{name:h,description:K,category:W}=Z(e);return{type:e,name:h,description:K,category:W??"Other"}}),k=i.value.toLocaleLowerCase();return g.filter(e=>!k||e.name.toLocaleLowerCase().includes(k))}function P(c,d,g){b.value[d]=!0;const k=c.target;k.src=`./../../../../components/category_${g}.svg`}function z(c,d){s.setSelection(null),c.dataTransfer.setData(`application/json;writer=${d},`,"{}")}function N(c){p(c)}return ee(w,()=>{i.value=""}),(c,d)=>(a(),$(se,{modelValue:i.value,"onUpdate:modelValue":d[1]||(d[1]=g=>i.value=g),class:"BuilderSidebarToolkit",placeholder:B.value},{default:q(()=>[(a(!0),m(I,null,X(y.value,(g,k)=>(a(),m("div",{key:k,class:"category"},[n("div",xe,F(k),1),n("div",Ee,[(a(!0),m(I,null,X(g,o=>(a(),m("div",{key:o.type,class:"tool","data-writer-tooltip":o.description,"data-writer-tooltip-placement":"right","data-writer-tooltip-gap":"8",draggable:"true","data-component-type":o.type,onDragend:d[0]||(d[0]=e=>N(e)),onDragstart:e=>z(e,o.type)},[n("img",{alt:`(Icon for ${o.name})`,src:`./../../../../components/${o.type}.svg`,draggable:"false",onError:e=>b.value[o.type]?void 0:P(e,o.type,o.category)},null,40,qe),n("div",Le,F(o.name),1)],40,Ve))),128))])]))),128))]),_:1},8,["modelValue","placeholder"]))}}),Ae=A(Me,[["__scopeId","data-v-23e9534b"]]),T=u=>(ae("data-v-921fc543"),u=u(),ne(),u),Pe=["draggable","data-automation-key"],We={key:0,class:"material-symbols-outlined"},je={key:1,class:"material-symbols-outlined"},Fe={class:"name"},Oe=T(()=>n("span",{class:"middot"},null,-1)),ze=T(()=>n("i",{class:"material-symbols-outlined"},"bolt",-1)),Ne=T(()=>n("span",{class:"middot"},null,-1)),Ke=T(()=>n("i",{class:"material-symbols-outlined"},"visibility_off",-1)),Re=T(()=>n("span",{class:"middot"},null,-1)),Ue=T(()=>n("i",{class:"material-symbols-outlined"},"terminal",-1)),Xe=T(()=>n("span",{class:"middot"},null,-1)),Ge={class:"previewText"},He={class:"children"},Qe=M({__name:"BuilderSidebarComponentTreeBranch",props:{componentId:{},query:{}},emits:["expandBranch"],setup(u,{emit:v}){const s=x(E.core),p=x(E.builderManager),i=L(!1),b=_(()=>p.getSelectedId()==o.componentId),{createAndInsertComponent:V,moveComponent:w,goToComponentParentPage:y,isDraggingAllowed:B}=oe(s,p),{getComponentInfoFromDrag:D,removeInsertionCandidacy:P,isParentSuitable:z}=te(s),{isComponentVisible:N}=Se(s),c=L(null),d=v,g=_(()=>{var l,f;const t=(l=o.query)==null?void 0:l.toLocaleLowerCase();return!!(!t||(f=R.value)!=null&&f.name.toLocaleLowerCase().includes(t)||Object.values(e.value.content).filter(C=>C.toLocaleLowerCase().includes(t)).length>0)}),k=_(()=>!g.value),o=u,e=_(()=>s.getComponentById(o.componentId)),h=_(()=>s.getComponents(o.componentId,{sortedByPosition:!0})),K=_(()=>h.value.length==0),W=_(()=>{var C,Q;const t=(C=R.value)==null?void 0:C.previewField;if(!t)return;const r=(Q=e.value.content)==null?void 0:Q[t];let l;const f=70;return(r==null?void 0:r.length)>f?l=r.substring(0,f)+"...":l=r,l}),R=_(()=>s.getComponentDefinition(e.value.type)),ie=_(()=>{var r,l,f,C;const t=e.value.type;return t=="html"&&((r=e.value.content)!=null&&r.element)?(l=e.value.content)==null?void 0:l.element:t=="workflows_workflow"?((f=e.value.content)==null?void 0:f.key)||"Workflow":((C=R.value)==null?void 0:C.name)??`Unknown (${e.value.type})`});async function H(){y(o.componentId),await O(),p.setSelection(o.componentId,void 0,"tree"),U()}function U(){i.value=!1,d("expandBranch")}function ce(){if(!c.value)return;const t=c.value.closest(".BuilderSidebarComponentTree"),r=t.getBoundingClientRect(),l=c.value.offsetTop-r.height/2;t.scrollTo({top:l,left:0,behavior:"smooth"})}function de(t){p.setSelection(null),t.dataTransfer.setData(`application/json;writer=${e.value.type},${e.value.id}`,"{}")}function ue(t){P(t)}function pe(t){const r=D(t);if(!r)return;const{draggedType:l,draggedId:f}=r;z(o.componentId,f,l)&&t.preventDefault()}function me(t){const r=D(t);if(!r)return;const{draggedType:l,draggedId:f}=r;f?w(f,e.value.id):V(l,e.value.id),P(t)}function fe(){i.value=!i.value}return ee(()=>p.getSelection(),async t=>{t&&t.componentId===o.componentId&&t.source!="tree"&&(U(),await O(),ce())},{immediate:!0}),(t,r)=>(a(),m("div",{ref_key:"rootEl",ref:c,class:"BuilderSidebarComponentTreeBranch"},[n("div",{class:ke(["main",{selected:b.value,notMatched:k.value,childless:K.value}]),tabindex:"0",draggable:J(B)(t.componentId),"data-automation-key":e.value.type,onClick:H,onKeydown:be(H,["enter"]),onDragover:pe,onDragstart:de,onDragend:ue,onDrop:me},[h.value.length>0?(a(),$(G,{key:0,class:"collapser",variant:"neutral",size:"icon",onClick:we(fe,["stop"])},{default:q(()=>[i.value?(a(),m("i",We,"expand_more")):(a(),m("i",je,"expand_less"))]),_:1})):S("",!0),n("span",Fe,F(ie.value),1),Object.keys(e.value.handlers??{}).length>0?(a(),m(I,{key:1},[Oe,ze],64)):S("",!0),J(N)(e.value.id)?S("",!0):(a(),m(I,{key:2},[Ne,Ke],64)),e.value.isCodeManaged?(a(),m(I,{key:3},[Re,Ue],64)):S("",!0),W.value?(a(),m(I,{key:4},[Xe,n("span",Ge,F(W.value),1)],64)):S("",!0)],42,Pe),Ce(n("div",He,[(a(!0),m(I,null,X(h.value,l=>(a(),$(re,{key:l.id,"component-id":l.id,query:t.query,onExpandBranch:U},null,8,["component-id","query"]))),128))],512),[[Ie,(!i.value||o.query)&&h.value.length>0]])],512))}}),re=A(Qe,[["__scopeId","data-v-921fc543"]]),le=u=>(ae("data-v-957f04cc"),u=u(),ne(),u),Ze={class:"add"},Je=le(()=>n("i",{class:"material-symbols-outlined"}," add ",-1)),Ye=le(()=>n("i",{class:"material-symbols-outlined"}," add ",-1)),et=M({__name:"BuilderSidebarComponentTree",setup(u){const v=x(E.core),s=x(E.builderManager),p=L(""),{createAndInsertComponent:i}=oe(v,s),b=_(()=>s.getMode()=="workflows"?"workflows_root":"root");async function V(){const y=i("page","root");v.setActivePageId(y),await O(),s.setSelection(y)}async function w(){const y=i("workflows_workflow","workflows_root");v.setActivePageId(y),await O(),s.setSelection(y)}return(y,B)=>(a(),$(se,{modelValue:p.value,"onUpdate:modelValue":B[0]||(B[0]=D=>p.value=D),class:"BuilderSidebarComponentTree",placeholder:"Component tree"},{default:q(()=>[j(re,{class:"rootBranch","component-id":b.value,query:p.value,"is-root":!0},null,8,["component-id","query"]),n("div",Ze,[b.value=="root"?(a(),$(G,{key:0,variant:"special",size:"small","data-automation-action":"add-page",onClick:V},{default:q(()=>[Je,Y(" Add page")]),_:1})):S("",!0),b.value=="workflows_root"?(a(),$(G,{key:1,variant:"special",size:"small","data-automation-action":"add-workflow",onClick:w},{default:q(()=>[Ye,Y(" Add workflow")]),_:1})):S("",!0)])]),_:1},8,["modelValue"]))}}),tt=A(et,[["__scopeId","data-v-957f04cc"]]),ot={class:"BuilderSidebar"},at=M({__name:"BuilderSidebar",setup(u){return(v,s)=>(a(),m("div",ot,[j(Ae),j(tt)]))}}),st=A(at,[["__scopeId","data-v-6e95684f"]]);export{st as default};
