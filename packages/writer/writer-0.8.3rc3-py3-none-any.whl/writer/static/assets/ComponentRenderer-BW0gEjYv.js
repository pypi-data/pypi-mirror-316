import{d as q,i as R,a as h,c as C,o as k,b as Z,B as fe,e as F,f as d,t as A,g as ve,r as B,p as P,w as N,h as D,u as ee,_ as K,j as _e,k as te,l as Y,v as J,m as oe,n as he,q as ge,W as ye,F as Ce,s as be,x as ne,y as se,z as ae,A as we,C as Se,D as Ee,E as Ie,G as Pe,H as Te,I as Me,J as Q}from"./index-Bu3rAGYU.js";import{f as $e}from"./instancePath-BsbOTTI8.js";const ke=10,De=q({__name:"ChildlessPlaceholder",props:{componentId:{type:String,required:!0}},setup(u){const n=R(h.core),_=u,p=(y,i)=>{const S=y.map(l=>n.getComponentDefinition(l)).map(l=>l==null?void 0:l.name);return`${S.slice(0,-1).join(", ")} ${S.length>1?i:""} ${S.at(-1)}`},s=C(()=>{const y=n.getContainableTypes(_.componentId);let i;return y.length<=ke&&(i=`You can add ${p(y,"and")} components`),i});return(y,i)=>(k(),Z(fe,{class:"ChildlessPlaceholder","component-id":u.componentId,message:s.value},null,8,["component-id","message"]))}}),Ae={class:"RenderError"},Be={class:"title"},Re={class:"message"},Ve=q({__name:"RenderError",props:{componentType:{},message:{}},setup(u){const n=u;return(_,p)=>(k(),F("div",Ae,[d("div",Be,[d("h2",null,"Error rendering "+A(n.componentType),1)]),d("div",Re,A(n.message),1)]))}}),xe={props:{componentId:{type:String,required:!0},instancePath:{type:Array,required:!0},instanceData:{type:Array,required:!0}},setup(u){const n=R(h.core),_=R(h.builderManager),p=u.componentId,s=C(()=>n.getComponentById(p)),y=ve(s.value.type),i=u.instancePath,T=u.instanceData,{getEvaluatedFields:S,isComponentVisible:$}=ee(n),l=S(i),I=C(()=>n.getComponents(p,{sortedByPosition:!0})),E=C(()=>!!_&&_.getMode()!="preview"),j=C(()=>{var o;return E.value&&!s.value.isCodeManaged&&s.value.type!=="root"&&s.value.type!=="workflows_root"&&((o=n.getComponentDefinition(s.value.type))==null?void 0:o.toolkit)!=="workflows"}),L=(o,a)=>(o?n.getContainableTypes(o):["root","workflows_root"]).includes(a),V=B(!1),e=()=>{if(!(I.value.length>0))return D(De,{componentId:s.value.id})},t=(o,a=0,m)=>D(re,{componentId:o,key:`${o}:${a}`,instancePath:[...i,{componentId:o,instanceNumber:a}],instanceData:[...T,B(null)],...m??{}}),r=o=>a=>{if(!L(p,a.type)&&o==="default")return!0;const c=n.getComponentDefinition(a.type).slot??"default";return c==="*"||c===o},f=(o=0,a="default",m=()=>!0,c=!1)=>{const v=g=>!E.value||c?[]:[D("div",{"data-writer-slot-of-id":p,"data-writer-position":g})],b=I.value.filter(r(a)).filter(m),w=b.filter(g=>!g.isCodeManaged).map(g=>t(g.id,o,{contextSlot:a})),x=b.filter(g=>g.isCodeManaged).map(g=>t(g.id,o,{contextSlot:a}));return[...v(0),...w.map((g,H)=>[g,v(H+1)]).flat(),...x]},M=$e(i);P(h.evaluatedFields,l),P(h.componentId,p),P(h.isBeingEdited,E),P(h.isDisabled,V),P(h.instancePath,i),P(h.instanceData,T),P(h.renderProxiedComponent,t),P(h.getChildrenVNodes,f),P(h.flattenedInstancePath,M);const W={"data-writer-id":p,"data-writer-instance-path":M},z=B(!1);N(()=>(_==null?void 0:_.getSelectedId())==p,o=>{z.value=o}),N(()=>l,()=>{z.value=!1},{deep:!0});const G=C(()=>I.value.length==0),ie=C(()=>$(p,i)),le=(o,a)=>{if(!o.startsWith("$goToPage_")&&!a)return c=>{let v=!1;n.userFunctions.value.some(b=>b.name==o&&b.args.includes("payload"))&&(v=!0),o.startsWith("$runWorkflow_")&&(v=!0),n.forwardEvent(c,i,v)};if(o.startsWith("$goToPage_")){const c=o.substring(10);return v=>n.setActivePageFromKey(c)}return null},ce=C(()=>{const o={},a=Object.keys(s.value.handlers??{}),m=s.value.binding?[s.value.binding.eventType]:[];return Array.from(new Set([...a,...m])).forEach(v=>{var x;const b=`on${v.charAt(0).toUpperCase()}${v.slice(1)}`,w=v===((x=s.value.binding)==null?void 0:x.eventType);o[b]=g=>{var U,X;w&&n.forwardEvent(g,i,!0);const H=(U=s.value.handlers)==null?void 0:U[v];H&&((X=le(H,w))==null||X(g))}}),o}),de=C(()=>{var m;const o=(m=n.getComponentDefinition(s.value.type))==null?void 0:m.fields;if(!o)return;const a={};return Object.keys(o).forEach(c=>{o[c].applyStyleVariable&&l[c]&&(a[`--${c}`]=l[c].value)}),a}),ue=C(()=>{var b;const o="cssClasses",a=(b=n.getComponentDefinition(s.value.type))==null?void 0:b.fields;if(!a||!a[o]||!l[o])return;const m=l[o].value,c=m==null?void 0:m.split(" ").map(w=>w.trim()),v={};return c.forEach(w=>{v[w]=!0}),v}),pe=function(){return{class:{[`wf-type-${s.value.type}`]:!0,component:!0,childless:G.value,selected:z.value,disabled:V.value,beingEdited:E.value,...ue.value},style:{...de.value,...ie.value?{}:{display:"none"}},...W,...V.value?[]:ce.value,draggable:j.value}},me=(o,a)=>E.value?D(Ve,{...o,componentType:s.value.type,message:a}):D("div");return()=>{const o=E.value?e():void 0,a=({instanceNumber:c=0,slotName:v="default",componentFilter:b=()=>!0,positionlessSlot:w=!1})=>G.value?w?void 0:o:f(c,v,b,w),m={...pe()};return L(s.value.parentId,s.value.type)?D(y,m,{default:a}):me(m,"Parent is not suitable for this component")}}},re=K(xe,[["__scopeId","data-v-e1b84039"]]),O=u=>(se("data-v-99f3ad1e"),u=u(),ae(),u),Fe=O(()=>d("i",{class:"icon material-symbols-outlined"}," notifications ",-1)),Le={class:"counter"},We=O(()=>d("div",{class:"balloonFlash"},null,-1)),He={class:"main"},qe={class:"clearContainer"},Oe=O(()=>d("i",{class:"material-symbols-outlined"}," clear_all ",-1)),je=O(()=>d("i",{class:"material-symbols-outlined"}," exclamation ",-1)),ze=[je],Ne={class:"content"},Ke={class:"title"},Ge={class:"time"},Ue={class:"message"},Xe=100,Ye=q({__name:"RendererNotifications",setup(u){const n=R(h.core),_=B(!1),p=B(null),s=_e([]),y=S=>{const{type:$,title:l,message:I,code:E}=S;s.unshift({type:$,title:l,message:I,code:E,timestampReceived:new Date}),s.splice(Xe),p.value.classList.remove("alert"),p.value.offsetWidth,p.value.classList.add("alert")};te(()=>{n.addMailSubscription("notification",y)});const i=()=>{s.length!=0&&(_.value=!_.value)},T=()=>{s.splice(0),_.value=!1};return(S,$)=>Y((k(),F("div",{class:"RendererNotifications colorTransformer",onClick:i},[d("div",{ref_key:"balloon",ref:p,class:"balloon",title:"Toggle notifications"},[Fe,d("div",Le,A(s.length),1)],512),We,Y(d("div",He,[d("div",qe,[oe(ye,{onClick:T},{default:he(()=>[Oe,ge(" Clear all ")]),_:1})]),(k(!0),F(Ce,null,be(s,(l,I)=>(k(),F("div",{key:I,class:"notification"},[d("div",{class:ne(["icon",l.type])},ze,2),d("div",Ne,[d("header",null,[d("strong",Ke,A(l.title),1),d("span",Ge,A(l.timestampReceived.toLocaleTimeString()),1)]),d("div",Ue,A(l.message),1)])]))),128))],512),[[J,_.value]])],512)),[[J,s.length>0]])}}),Je=K(Ye,[["__scopeId","data-v-99f3ad1e"]]),Qe=u=>(se("data-v-44c555ab"),u=u(),ae(),u),Ze=Qe(()=>d("div",{class:"loadingBar"},null,-1)),et={class:"rootComponentArea"},tt=q({__name:"ComponentRenderer",setup(u){const n=R(h.core),_=R(h.builderManager),p=ee(n),s={},y=C(()=>_&&_.getMode()=="workflows"?"workflows_root":"root"),i=p.getEvaluatedFields([{componentId:"root",instanceNumber:0}]),T=C(()=>{var e,t,r,f,M,W;return{...we,"--accentColor":(e=i.accentColor)==null?void 0:e.value,"--emptinessColor":(t=i.emptinessColor)==null?void 0:t.value,"--containerBackgroundColor":(r=i.parentIdBackgroundColor)==null?void 0:r.value,"--primaryTextColor":(f=i.primaryTextColor)==null?void 0:f.value,"--secondaryTextColor":(M=i.secondaryTextColor)==null?void 0:M.value,"--separatorColor":(W=i.separatorColor)==null?void 0:W.value}}),S=C(()=>n.frontendMessageMap.value.size>0);N(()=>{var e;return(e=i.appName)==null?void 0:e.value},e=>{e!=""&&$(e)},{immediate:!0});function $(e){const t=n.mode.value;let r;e&&t=="edit"?r=`${e} | Writer Framework | Builder`:!e&&t=="edit"?r="Writer Framework | Builder":e&&t=="run"?r=`${e}`:!e&&t=="run"&&(r="Writer Framework App"),document.title=r}async function l(e,t){const r=document.querySelector(`[data-writer-stylesheet-key="${e}"]`);r==null||r.remove();const f=document.createElement("link");f.dataset.writerStylesheetKey=e,f.setAttribute("href",t),f.setAttribute("rel","stylesheet"),document.head.appendChild(f)}async function I(e,t){const r=document.querySelector(`[data-writer-script-key="${e}"]`);r==null||r.remove();const f=document.createElement("script");f.dataset.writerScriptKey=e,f.src=t,f.setAttribute("rel","modulepreload"),document.head.appendChild(f)}async function E(e,t){s[e]=t,await Q(()=>import(t),[],import.meta.url)}async function j(e,t,r){const f=s[e],M=await Q(()=>import(f),[],import.meta.url);if(!M){console.warn(`The module with key "${e}" cannot be found. Please check that it has been imported.`);return}M[t](...r)}function L(){n.addMailSubscription("fileDownload",e=>{const t=document.createElement("a");t.href=e.data,t.download=e.fileName,t.click()}),n.addMailSubscription("openUrl",e=>{const t=document.createElement("a");t.href=e,t.target="_blank",t.rel="noopener noreferrer",t.click()}),n.addMailSubscription("pageChange",e=>{Pe(e)}),n.addMailSubscription("routeVarsChange",e=>{Te(e)}),n.addMailSubscription("importStylesheet",({stylesheetKey:e,path:t})=>{l(e,t)}),n.addMailSubscription("importScript",({scriptKey:e,path:t})=>{I(e,t)}),n.addMailSubscription("importModule",({moduleKey:e,specifier:t})=>{E(e,t)}),n.addMailSubscription("functionCall",({moduleKey:e,functionName:t,args:r})=>{j(e,t,r)})}function V(){const e=Me(),t=new CustomEvent("wf-app-open",{detail:{payload:e}}),r={componentId:"root",instanceNumber:0};n.forwardEvent(t,[r],!0)}return Se(()=>{L()}),te(()=>{V()}),(e,t)=>(k(),F("main",{class:ne(["ComponentRenderer",{loadingActive:S.value}]),tabindex:"-1",style:Ie(T.value)},[oe(Je,{class:"notifications"}),Ze,d("div",et,[(k(),Z(re,{key:y.value,"component-id":y.value,"instance-path":[{componentId:y.value,instanceNumber:0}],"instance-data":[B(null)]},null,8,["component-id","instance-path","instance-data"])),Ee(e.$slots,"default",{},void 0,!0)])],6))}}),st=K(tt,[["__scopeId","data-v-44c555ab"]]);export{st as default};
