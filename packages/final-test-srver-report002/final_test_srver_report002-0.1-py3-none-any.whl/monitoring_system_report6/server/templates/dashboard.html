<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Monitoring System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Times New Roman, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #006064;
            margin-bottom: 20px;
        }

        /* Layout for the dashboard */
        .dashboard-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-gap: 20px;
            margin-bottom: 30px;
        }

        .tile {
            background-color: #006064;
            color: white;
            border-radius: 8px;
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);
        }

        /* Line charts section */
        .line-chart-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 20px;
        }

        .line-chart{
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);
            padding: 20px;
        }

        .bar-chart {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);
            padding: 20px;
        }

        .bar-chart {
            text-align: center;
        }
        .pie-chart {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);
            padding: 20px; /* Reduced padding */
            max-width: 400px; /* Set a max-width for the pie chart container */
            margin: 0 auto; /* Center align the pie chart */
        }

        .pie-chart canvas {
            width: 100% !important; /* Ensure the canvas takes up full width within the container */
            height: 250px; /* Set a fixed height for the pie chart */
            max-height: 300px; /* Limit the height */
            margin: 0 auto; /* Center the canvas inside the div */
        }

        .pie-chart {
            text-align: center;
            padding: 20px; /* Less padding for compactness */
        }
          .redirect-button {
            font-family: Times New Roman, sans-serif;
            display: block;
            width: 200px;
            height: 40px;
            margin: 30px auto;
            background-color: #006064;
            color: white;
            font-size: 20px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
        }

        .redirect-button:hover {
            background-color: #004d40;
        }

        /* Add some responsiveness for smaller screens */
        @media (max-width: 768px) {
            .dashboard-container {
                grid-template-columns: repeat(2, 1fr);
            }

            .line-chart-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>


<h1>Server Monitoring</h1>

    <!-- Dashboard Tiles -->
    <div class="dashboard-container">
        <div class="tile">
            <h3>CPU Count</h3>
            <div id="cpuCount">Loading...</div>
        </div>
        <div class="tile">
            <h3>Memory Usage</h3>
            <div id="totalUsedMemory">Loading...</div>
        </div>
        <div class="tile">
            <h3>CPU Usage</h3>
            <div id="cpuUsagePercentage">Loading...</div>
        </div>
        <div class="tile">
            <h3>Disk Usage</h3>
            <div id="totalDiskUsage">Loading...</div>
        </div>
    </div>

    <!-- Line Charts and Doughnut Chart -->
    <div class="line-chart-container">
        <div class="line-chart" id="cpuUsagegraph">
            <h3>CPU Usage Over Time</h3>
            <canvas id="cpuUsageChart"></canvas>
        </div>
        <div class="line-chart" id="lineChartMemory">
            <h3>Memory Usage Over Time</h3>
            <canvas id="cpuMemoryChart"></canvas>
        </div>
        <div class="line-chart" id="diskUsageChart">
            <h3>Load Average Over Time</h3>
            <canvas id="cpuLoadAvg"></canvas>
        </div>
        <div class="bar-chart" id="networkSpeedChart">
            <h3>CPU Time</h3>
            <canvas id="cpuUser"></canvas>
        </div>
        <button class="redirect-button" onclick="window.location.href='https://www.cybrosys.com';">Go to Website</button>

    </div>
<script>
    //CPU Count tile data

const cpuCount = [
 {% for metric in metrics %}
     {% if metric.metric == "cpu_count" %}
         {
             value: {{ metric.value }}
         },
     {% endif %}
 {% endfor %}
];

const cpuCountValue = cpuCount.length > 0 ? cpuCount[0].value : "N/A";
document.getElementById('cpuCount').innerText = `${cpuCountValue}`;

<!--total memory used-->

const totalUsedMemory = [
 {% for metric in metrics %}
     {% if metric.metric == "total_used_memory" %}
         {
             value: {{ metric.value }}
         },
     {% endif %}
 {% endfor %}
];

const TotalMemoryValue = totalUsedMemory.length > 0 ? totalUsedMemory[0].value : "N/A";
document.getElementById('totalUsedMemory').innerText = `${TotalMemoryValue}%`;

<!--cpu usage in percentage-->

const cpuUsagePercentage = [
 {% for metric in metrics %}
     {% if metric.metric == "cpu" %}
         {
             value: {{ metric.value }}
         },
     {% endif %}
 {% endfor %}
];

const cpuUsagePercentageValue = cpuUsagePercentage.length > 0 ? cpuUsagePercentage[0].value : "N/A";
document.getElementById('cpuUsagePercentage').innerText = `${cpuUsagePercentageValue}%`;

<!--total disk used-->

const totalDiskUsage = [
 {% for metric in metrics %}
     {% if metric.metric == "total_used_disk" %}
         {
             value: {{ metric.value }}
         },
     {% endif %}
 {% endfor %}
];

const TotalDiskValue = totalDiskUsage.length > 0 ? totalDiskUsage[0].value : "N/A";
document.getElementById('totalDiskUsage').innerText = `${TotalDiskValue}%`;

// Data passed from the backend as an array of objects
const cpuMetrics = [
  {% for metric in metrics %}
      {% if metric.metric == "cpu" %}
          {
              timestamp: "{{ metric.timestamp }}",
              value: {{ metric.value }}
          },
      {% endif %}
  {% endfor %}
];

// Extract labels (timestamps) and values for CPU chart
const cpuLabels = cpuMetrics.map(metric => metric.timestamp);
const cpuData = cpuMetrics.map(metric => metric.value);

const ctxCpu = document.getElementById('cpuUsageChart').getContext('2d');
new Chart(ctxCpu, {
  type: 'line',
  data: {
      labels: cpuLabels,
      datasets: [{
          label: 'CPU Usage',
          data: cpuData,
          borderColor: 'rgba(75, 192, 192, 1)',
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          tension: 0.3,
          fill: true
      }]
  },
  options: {
      responsive: true,
      scales: {
          x: { title: { display: true, text: 'Timestamp' } },
          y: { title: { display: true, text: 'CPU Usage (%)' }, beginAtZero: true }
      }
  }
});

const memoryMetrics = [
  {% for metric in metrics %}
      {% if metric.metric == "memory" %}
          {
              timestamp: "{{ metric.timestamp }}",
              value: {{ metric.value }}
          },
      {% endif %}
  {% endfor %}
];

// Extract labels (timestamps) and values for Memory chart
const memoryLabels = memoryMetrics.map(metric => metric.timestamp);
const memoryData = memoryMetrics.map(metric => metric.value);

// Render the Memory Usage Line Chart
const ctxMemory = document.getElementById('cpuMemoryChart').getContext('2d');
new Chart(ctxMemory, {
  type: 'line',
  data: {
      labels: memoryLabels,
      datasets: [{
          label: 'Memory Usage',
          data: memoryData,
          borderColor: 'rgba(255, 99, 132, 1)',
          backgroundColor: 'rgba(255, 99, 132, 0.2)',
          tension: 0.3,
          fill: true
      }]
  },
  options: {
      responsive: true,
      scales: {
          x: { title: { display: true, text: 'Timestamp' } },
          y: { title: { display: true, text: 'Memory Usage (%)' }, beginAtZero: true }
      }
  }
});

// CPU Load Average
const cpuLoadAvgMetrics = [
  {% for metric in metrics %}
      {% if metric.metric == "1_min_load_avg" %}
          {
              timestamp: "{{ metric.timestamp }}",
              value: {{ metric.value }}
          },
      {% endif %}
  {% endfor %}
];

const fiveMinCpuLoadAvgMetrics = [
  {% for metric in metrics %}
      {% if metric.metric == "5_min_load_avg" %}
          {
              timestamp: "{{ metric.timestamp }}",
              value: {{ metric.value }}
          },
      {% endif %}
  {% endfor %}
];

const fifteenMinCpuLoadAvgMetrics = [
  {% for metric in metrics %}
      {% if metric.metric == "15_min_load_avg" %}
          {
              timestamp: "{{ metric.timestamp }}",
              value: {{ metric.value }}
          },
      {% endif %}
  {% endfor %}
];

const cpuLoadAvgLabels = cpuLoadAvgMetrics.map(metric => metric.timestamp);
const loadAvgData = cpuLoadAvgMetrics.map(metric => metric.value);
const fiveMinCpuLoadAvgLabels = fiveMinCpuLoadAvgMetrics.map(metric => metric.timestamp);
const fiveMinLoadAvgData = fiveMinCpuLoadAvgMetrics.map(metric => metric.value);
const fifteenMinCpuLoadAvgLabels = fifteenMinCpuLoadAvgMetrics.map(metric => metric.timestamp);
const fifteenMinLoadAvgData = fifteenMinCpuLoadAvgMetrics.map(metric => metric.value);

const ctxLoadAvg = document.getElementById('cpuLoadAvg').getContext('2d');
new Chart(ctxLoadAvg, {
  type: 'line',
  data: {
      labels: cpuLoadAvgLabels,
      datasets: [
          {
              label: 'CPU 1 min Load Avg',
              data: loadAvgData,
              borderColor: 'rgba(255, 99, 132, 1)',
              backgroundColor: 'rgba(255, 99, 132, 0.2)',
              tension: 0.1,
              fill: false
          },
          {
              label: 'CPU 5 min Load Avg',
              data: fiveMinLoadAvgData,
              borderColor: 'rgba(54, 162, 235, 1)',
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              tension: 0.1,
              fill: false
          },
          {
              label: 'CPU 15 min Load Avg',
              data: fifteenMinLoadAvgData,
              borderColor: 'rgba(75, 192, 192, 1)',
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              tension: 0.1,
              fill: false
          }
      ]
  },
  options: {
      responsive: true,
      scales: {
          x: {
              title: {
                  display: true,
                  text: 'Timestamp'
              }
          },
          y: {
              title: {
                  display: true,
                  text: 'CPU Load Avg'
              },
              beginAtZero: true
          }
      }
  }
});

<!--cputimes barcharts-->

const cpuTime = [
  {% for metric in metrics %}
      {% if metric.metric == "cpu_user_times" %}
          {
              value: {{ metric.value }}
          },
      {% endif %}
  {% endfor %}
];

const cpuIdleTime = [
  {% for metric in metrics %}
      {% if metric.metric == "cpu_idle_times" %}
          {
              value: {{ metric.value }}
          },
      {% endif %}
  {% endfor %}
];

const cpuSystemTime = [
  {% for metric in metrics %}
      {% if metric.metric == "cpu_system_times" %}
          {
              value: {{ metric.value }}
          },
      {% endif %}
  {% endfor %}
];

const cpuTimesData = cpuTime.length > 0 ? cpuTime[0].value : 0;
const cpuIdleData = cpuIdleTime.length > 0 ? cpuIdleTime[0].value : 0;
const cpuSystemData = cpuSystemTime.length > 0 ? cpuSystemTime[0].value : 0;

const barChartOptions = {
    responsive: true,
    plugins: {
        legend: {
            display: false,  // Enable legend display
            position: 'top', // Position legend at the top
            labels: {
                color: '#000', // Text color for the legend
                boxWidth: 20,  // Width of the color box
            }
        },
        tooltip: {
            callbacks: {
                label: function(tooltipItem) {
                    return `${tooltipItem.label}: ${tooltipItem.raw}%`;
                }
            }
        }
    },
    scales: {
        x: {
            title: {
                display: true,
                text: 'CPU Times'
            }
        },
        y: {
            title: {
                display: true,
                text: 'Percentage (%)'
            },
            beginAtZero: true
        }
    }
};

// Create Bar Chart
new Chart(document.getElementById('cpuUser'), {
    type: 'bar',
    data: {
        labels: ['User Time', 'Idle Time', 'System Time'], // Labels for the bars
        datasets: [{
            label: 'CPU Usage', // Dataset label for the legend
            data: [cpuTimesData, cpuIdleData, cpuSystemData],  // Values for each bar
            backgroundColor: [
                'rgba(255, 99, 132, 1)',   // Pink
                'rgba(54, 162, 235, 1)',   // Blue
                'rgba(75, 192, 192, 1)'    // Turquoise
            ],
            borderWidth: 1
        }]
    },
    options: barChartOptions
});


</script>
</body>
</html>