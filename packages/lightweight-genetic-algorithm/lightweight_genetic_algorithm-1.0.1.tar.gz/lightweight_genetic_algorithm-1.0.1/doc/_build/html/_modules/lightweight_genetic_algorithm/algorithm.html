<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>lightweight_genetic_algorithm.algorithm &#8212; Lightweight Genetic Algorithm 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <script src="../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for lightweight_genetic_algorithm.algorithm</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">.selection</span> <span class="kn">import</span> <span class="n">SurvivorSelection</span><span class="p">,</span> <span class="n">DiversityEnhancedSurvivorSelection</span><span class="p">,</span> <span class="n">FitnessProportionalSurvivorSelection</span>
<span class="kn">from</span> <span class="nn">.crossover</span> <span class="kn">import</span> <span class="n">CrossoverBetween</span><span class="p">,</span> <span class="n">CrossoverMidpoint</span><span class="p">,</span> <span class="n">CrossoverEitherOr</span>
<span class="kn">from</span> <span class="nn">.mutation</span> <span class="kn">import</span> <span class="n">Mutation</span>
<span class="kn">from</span> <span class="nn">.population</span> <span class="kn">import</span> <span class="n">Individual</span><span class="p">,</span> <span class="n">NumericGene</span><span class="p">,</span> <span class="n">CategoricalGene</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span> 

<div class="viewcode-block" id="GeneticAlgorithm">
<a class="viewcode-back" href="../../lightweight_genetic_algorithm.html#lightweight_genetic_algorithm.algorithm.GeneticAlgorithm">[docs]</a>
<span class="k">class</span> <span class="nc">GeneticAlgorithm</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to represent a Genetic Algorithm.</span>

<span class="sd">    This class provides methods to perform optimization using genetic algorithms</span>
<span class="sd">    for both numerical and categorical parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fitness_function : callable</span>
<span class="sd">        A function that calculates the fitness score of an individual.</span>
<span class="sd">    gene_ranges : list</span>
<span class="sd">        A list specifying the possible values or ranges for each gene.</span>
<span class="sd">        For numerical genes, it is a list of tuples specifying the (min, max) range for each gene.</span>
<span class="sd">        For categorical genes, it is a simple list of possible categories.</span>
<span class="sd">    fitness_function_args : tuple, optional</span>
<span class="sd">        Additional arguments to pass to the fitness_function (default is ()).</span>
<span class="sd">    number_of_genes : int, optional</span>
<span class="sd">        The number of genes in each individual. If genes are numerical,</span>
<span class="sd">        it defaults to the length of gene_ranges. Must be specified if genes are categorical.</span>
<span class="sd">    crossover_method : str, optional</span>
<span class="sd">        The method used for crossover. Options are &quot;Between&quot;, &quot;Midpoint&quot;, &quot;Either Or&quot;, or &quot;None&quot;.</span>
<span class="sd">        Default is &quot;Either Or&quot;.</span>
<span class="sd">    mutation_mode : list of str, optional</span>
<span class="sd">        The mode used for mutation for each gene.</span>
<span class="sd">        Available options are: &quot;additive&quot;, &quot;multiplicative&quot;, &quot;random&quot;, &quot;categorical&quot;.</span>
<span class="sd">        Default is [&quot;additive&quot;]*number_of_genes for numerical genes and [&quot;categorical&quot;]*number_of_genes for categorical genes.</span>
<span class="sd">    mutation_rate : float, optional</span>
<span class="sd">        The rate of mutation for each gene. Default is 1.0 / number_of_genes.</span>
<span class="sd">    measure : str or callable, optional</span>
<span class="sd">        Defines the distance measure between two individuals for diversity.</span>
<span class="sd">        Options are &quot;Hamming&quot;, &quot;Euclidean&quot;, &quot;Dynamic&quot;, or a custom function.</span>
<span class="sd">        Default depends on gene type: &quot;Hamming&quot; for categorical genes, &quot;Euclidean&quot; for numerical genes.</span>
<span class="sd">    r0 : float, optional</span>
<span class="sd">        The characteristic distance beyond which there is no diversity penalty (default is 1/10 of the average spread of initial population). Only used for diversity enhanced selection.</span>
<span class="sd">    D0 : float, optional</span>
<span class="sd">        The maximum diversity penalty for identical individuals (default is 1.0). Only used for diversity enhanced selection.</span>
<span class="sd">    use_multiprocessing : bool, optional</span>
<span class="sd">        Whether to use multiprocessing for fitness evaluations (default is False).</span>
<span class="sd">    ncpus : int, optional</span>
<span class="sd">        The number of processes to use for multiprocessing (default is the number of CPUs minus one).</span>
<span class="sd">    verbosity : int, optional</span>
<span class="sd">        The verbosity level. 0 = silent, 1 = normal output, 2 = detailed output (default is 1).</span>
<span class="sd">    selection_method : str, optional</span>
<span class="sd">        The method used for selecting the best individuals for the next generation.</span>
<span class="sd">        Options are &quot;Diversity Enhanced&quot; or &quot;Fitness Proportionate&quot; (default is &quot;Diversity Enhanced&quot;).</span>
<span class="sd">    output_directory : str, optional</span>
<span class="sd">        The directory to save output files (default is None).</span>
<span class="sd">        If specified, the algorithm saves the genes of the selected survivors in each generation</span>
<span class="sd">        to a file &quot;&lt;datetime&gt;_survivors.npy&quot; in the output directory.</span>
<span class="sd">        The average fitness and best fitness at each generation are saved to &quot;&lt;datetime&gt;_fitness.txt&quot;.</span>
<span class="sd">        A log file is saved to &quot;log.txt&quot; containing the output of the algorithm printed to the console.</span>

<span class="sd">        The &quot;&lt;datetime&gt;_survivors.npy&quot; file can be loaded using</span>
<span class="sd">        numpy.load(file, allow_pickle=True) to access the gene values of the individuals</span>
<span class="sd">        in each generation. The loaded array has shape</span>
<span class="sd">        (n_generations+1, population_size, number_of_genes) since the initial population is also saved.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    fitness_function : callable</span>
<span class="sd">        The fitness function used to evaluate individuals.</span>
<span class="sd">    fitness_function_args : tuple</span>
<span class="sd">        Additional arguments for the fitness function.</span>
<span class="sd">    gene_ranges : list</span>
<span class="sd">        The ranges or categories for each gene.</span>
<span class="sd">    number_of_genes : int</span>
<span class="sd">        The number of genes in each individual.</span>
<span class="sd">    is_discrete : bool</span>
<span class="sd">        Indicates whether the genes are categorical.</span>
<span class="sd">    mutation_mode : list of str</span>
<span class="sd">        Mutation modes for each gene.</span>
<span class="sd">    mutation_rate : float</span>
<span class="sd">        Mutation rate for each gene.</span>
<span class="sd">    mutation : Mutation</span>
<span class="sd">        The mutation operator.</span>
<span class="sd">    crossover_method : Crossover or str</span>
<span class="sd">        The crossover operator or &quot;none&quot; if no crossover.</span>
<span class="sd">    survivor_selection : SurvivorSelection</span>
<span class="sd">        The survivor selection strategy.</span>
<span class="sd">    use_multiprocessing : bool</span>
<span class="sd">        Indicates whether multiprocessing is used.</span>
<span class="sd">    ncpus : int</span>
<span class="sd">        Number of CPUs used if multiprocessing.</span>
<span class="sd">    pool : multiprocessing.Pool or None</span>
<span class="sd">        The multiprocessing Pool object if multiprocessing is used.</span>
<span class="sd">    verbosity : int</span>
<span class="sd">        Verbosity level.</span>
<span class="sd">    output_directory : str</span>
<span class="sd">        Directory for output files.</span>
<span class="sd">    fitness_file : str</span>
<span class="sd">        Path to the file where fitness values are saved (if output_directory is specified).</span>
<span class="sd">    survivors_file : str</span>
<span class="sd">        Path to the file where survivor gene values are saved (if output_directory is specified).</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    run(n_generations, population_size, init_genes=None, fitness_threshold=None, verbosity=1)</span>
<span class="sd">        Runs the genetic algorithm and returns the population at each generation.</span>
<span class="sd">    run_light(n_generations, population_size, init_genes=None, fitness_threshold=None, verbosity=1)</span>
<span class="sd">        Runs the genetic algorithm and returns the gene values at each generation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fitness_function</span><span class="p">,</span> <span class="n">gene_ranges</span><span class="p">,</span> <span class="n">fitness_function_args</span><span class="o">=</span><span class="p">(),</span> <span class="n">number_of_genes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">crossover_method</span><span class="o">=</span><span class="s2">&quot;Either Or&quot;</span><span class="p">,</span> <span class="n">mutation_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mutation_rate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">measure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">r0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">D0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">use_multiprocessing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ncpus</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">selection_method</span><span class="o">=</span><span class="s2">&quot;Diversity Enhanced&quot;</span><span class="p">,</span> 
                 <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Verbosity level for printing out messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">=</span> <span class="n">output_directory</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_output_directory</span><span class="p">()</span>

        <span class="c1"># User-defined function to calculate fitness score of each individual</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitness_function</span> <span class="o">=</span> <span class="n">fitness_function</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">fitness_function_args</span> <span class="o">=</span> <span class="n">fitness_function_args</span>

        <span class="c1"># Parameter ranges of genes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gene_ranges</span> <span class="o">=</span> <span class="n">gene_ranges</span>

        <span class="c1"># Function to check if parameters are a 1D list. If true, the parameters are treated as categories</span>
        <span class="k">def</span> <span class="nf">is_one_dimensional</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">)</span>
        
        <span class="c1"># Store results of parameter check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_discrete</span> <span class="o">=</span> <span class="n">is_one_dimensional</span><span class="p">(</span><span class="n">gene_ranges</span><span class="p">)</span>

        <span class="c1"># If parameters are categories, we print out the corresponding notice</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_discrete</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Detected categorical genes.&quot;</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Detected numeric genes.&quot;</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Raise error if number of parameters is not provided for categorical parameters</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_discrete</span> <span class="ow">and</span> <span class="n">number_of_genes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Your gene_ranges is a list of values, which assumes categorical genes but you have not given the number of genes in each individual with the number of parameters.&quot;</span><span class="p">)</span>
  
        <span class="c1"># For categorical parameters, we use their provided count. For numerical parameters, we infer the count from the parameter ranges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_genes</span> <span class="o">=</span> <span class="n">number_of_genes</span> <span class="k">if</span> <span class="n">number_of_genes</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">gene_ranges</span><span class="p">)</span>
  
        <span class="c1"># Set default mutation mode based on gene type</span>
        <span class="n">default_mutation_mode</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;additive&quot;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_genes</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_discrete</span> <span class="k">else</span> <span class="p">[</span><span class="s2">&quot;categorical&quot;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_genes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutation_mode</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">mutation_mode</span><span class="p">]</span> <span class="k">if</span> <span class="n">mutation_mode</span> <span class="k">else</span> <span class="n">default_mutation_mode</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mutation mode: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mutation_mode</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Check if mutation methods are valid</span>
        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;additive&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplicative&#39;</span><span class="p">,</span> <span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="s1">&#39;categorical&#39;</span><span class="p">}:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid mutation mode &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;. Available options are: &#39;additive&#39;, &#39;multiplicative&#39;, &#39;random&#39;, &#39;categorical&#39;. Defaulting to &#39;additive&#39;!&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mutation_rate</span> <span class="o">=</span> <span class="n">mutation_rate</span> <span class="k">if</span> <span class="n">mutation_rate</span> <span class="k">else</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mutation rate: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mutation_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mutation</span> <span class="o">=</span> <span class="n">Mutation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mutation_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gene_ranges</span><span class="p">)</span>

        <span class="c1"># Map string to corresponding crossover method</span>
        <span class="n">crossover_methods</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;between&quot;</span><span class="p">:</span> <span class="n">CrossoverBetween</span><span class="p">(),</span>
            <span class="s2">&quot;midpoint&quot;</span><span class="p">:</span> <span class="n">CrossoverMidpoint</span><span class="p">(),</span>
            <span class="s2">&quot;either or&quot;</span><span class="p">:</span> <span class="n">CrossoverEitherOr</span><span class="p">(),</span> 
            <span class="s2">&quot;none&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">crossover_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">crossover_methods</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid crossover method &#39;</span><span class="si">{</span><span class="n">crossover_method</span><span class="si">}</span><span class="s2">&#39;. Available options are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">crossover_methods</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">. Defaulting to &#39;Between&#39;!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crossover_method</span> <span class="o">=</span> <span class="n">crossover_methods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">crossover_method</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">CrossoverBetween</span><span class="p">())</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Crossover method: </span><span class="si">{</span><span class="n">crossover_method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1">##### Set-up the diversity enhanced survivor selection ##### </span>
        <span class="k">if</span> <span class="n">selection_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;diversity enhanced&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Using diversity enhanced selection.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1"># (1) Set the distance measure function</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">measure</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_discrete</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;No measure given, defaulting to Hamming measure.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="s1">&#39;hamming&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;No measure given, defaulting to Euclidean measure.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="s1">&#39;euclidean&#39;</span>   
            <span class="k">elif</span> <span class="n">measure</span> <span class="o">==</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Using dynamic measure.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_discrete</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Dynamic measure is not compatible with categorical parameters.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="s1">&#39;dynamic&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using user-defined input distance measure.&quot;</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="n">measure</span>  
            <span class="c1"># (2) Create SurvivorSelection instance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">survivor_selection</span> <span class="o">=</span> <span class="n">DiversityEnhancedSurvivorSelection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">selection_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Fitness Proportionate&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Using fitness proportionate selection.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">survivor_selection</span> <span class="o">=</span> <span class="n">FitnessProportionalSurvivorSelection</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid selection method. Available options are: &#39;Diversity Enhanced&#39;, &#39;Fitness Proportionate&#39;.&quot;</span><span class="p">)</span>
        <span class="c1"># Setting r0 and D0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">survivor_selection</span><span class="p">,</span> <span class="n">DiversityEnhancedSurvivorSelection</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">survivor_selection</span><span class="o">.</span><span class="n">r0</span> <span class="o">=</span> <span class="n">r0</span> <span class="k">if</span> <span class="n">r0</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">survivor_selection</span><span class="o">.</span><span class="n">D0</span> <span class="o">=</span> <span class="n">D0</span> <span class="k">if</span> <span class="n">D0</span> <span class="k">else</span> <span class="mf">1.0</span>
        
        <span class="c1"># Setup multiprocessing if specified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_multiprocessing</span> <span class="o">=</span> <span class="n">use_multiprocessing</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_multiprocessing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Using multiprocessing.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mp</span> <span class="o">=</span> <span class="n">mp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ncpus</span> <span class="o">=</span> <span class="n">ncpus</span> <span class="k">if</span> <span class="n">ncpus</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span>
            <span class="c1"># Initialize the multiprocessing Pool</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncpus</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Not using multiprocessing.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="kc">None</span>
    
<div class="viewcode-block" id="GeneticAlgorithm.log">
<a class="viewcode-back" href="../../lightweight_genetic_algorithm.html#lightweight_genetic_algorithm.algorithm.GeneticAlgorithm.log">[docs]</a>
    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logs a message to the console and, if specified, to the output directory log file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        message : str</span>
<span class="sd">            The message to log.</span>
<span class="sd">        level : int, optional</span>
<span class="sd">            The level of verbosity required to print the message (default is 1).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="n">level</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="si">}</span><span class="s2">/log.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GeneticAlgorithm.setup_output_directory">
<a class="viewcode-back" href="../../lightweight_genetic_algorithm.html#lightweight_genetic_algorithm.algorithm.GeneticAlgorithm.setup_output_directory">[docs]</a>
    <span class="k">def</span> <span class="nf">setup_output_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the output directory for saving logs and output files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>

        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output directory created at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">file_id</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitness_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="si">}{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">_fitness.txt&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">survivors_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="si">}{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">_survivors.npy&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Writing fitness values to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fitness_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Writing gene values to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">survivors_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitness_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Generation Average_Fitness Best_Fitness</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GeneticAlgorithm.start_pool">
<a class="viewcode-back" href="../../lightweight_genetic_algorithm.html#lightweight_genetic_algorithm.algorithm.GeneticAlgorithm.start_pool">[docs]</a>
    <span class="k">def</span> <span class="nf">start_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts the multiprocessing Pool if multiprocessing is enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_multiprocessing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncpus</span><span class="p">)</span></div>


<div class="viewcode-block" id="GeneticAlgorithm.stop_pool">
<a class="viewcode-back" href="../../lightweight_genetic_algorithm.html#lightweight_genetic_algorithm.algorithm.GeneticAlgorithm.stop_pool">[docs]</a>
    <span class="k">def</span> <span class="nf">stop_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes the multiprocessing Pool if it is open.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="GeneticAlgorithm.evaluate_fitness">
<a class="viewcode-back" href="../../lightweight_genetic_algorithm.html#lightweight_genetic_algorithm.algorithm.GeneticAlgorithm.evaluate_fitness">[docs]</a>
    <span class="k">def</span> <span class="nf">evaluate_fitness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluates the fitness of a set of genes using the fitness function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        genes : list</span>
<span class="sd">            The genes to evaluate.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The fitness value of the genes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_function</span><span class="p">(</span><span class="n">genes</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fitness_function_args</span><span class="p">)</span></div>


<div class="viewcode-block" id="GeneticAlgorithm.create_initial_population">
<a class="viewcode-back" href="../../lightweight_genetic_algorithm.html#lightweight_genetic_algorithm.algorithm.GeneticAlgorithm.create_initial_population">[docs]</a>
    <span class="k">def</span> <span class="nf">create_initial_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">init_gene_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the initial population of individuals.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int</span>
<span class="sd">            The number of individuals in the population.</span>
<span class="sd">        init_gene_values : list, optional</span>
<span class="sd">            Initial gene values to seed the population. If None, the population is initialized randomly.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of Individual</span>
<span class="sd">            The initial population of individuals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating initial population of size </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Create genes of the population</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_discrete</span><span class="p">:</span>
            <span class="c1"># Expecting a 1D list for discrete parameters</span>
            <span class="n">genes</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="n">CategoricalGene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gene_ranges</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_genes</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Expecting a 2D list for continuous parameters.</span>
            <span class="n">genes</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="n">NumericGene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gene_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_genes</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">]</span>

        <span class="c1"># If initial gene values are specified, use them to overwrite the initial population genes</span>
        <span class="k">if</span> <span class="n">init_gene_values</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_genes</span><span class="p">):</span>
                    <span class="n">genes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">init_gene_values</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="c1"># Create population using multiprocessing if specified</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_multiprocessing</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncpus</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
                <span class="n">population</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">Individual</span><span class="p">,</span> <span class="p">[(</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_function_args</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">genes</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">population</span>
        
        <span class="c1"># Otherwise, create population sequentially</span>
        <span class="n">population</span> <span class="o">=</span> <span class="p">[</span><span class="n">Individual</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_function_args</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">genes</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">population</span></div>


<div class="viewcode-block" id="GeneticAlgorithm.run">
<a class="viewcode-back" href="../../lightweight_genetic_algorithm.html#lightweight_genetic_algorithm.algorithm.GeneticAlgorithm.run">[docs]</a>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_generations</span><span class="p">,</span> <span class="n">population_size</span><span class="p">,</span> <span class="n">init_genes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fitness_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Runs the genetic algorithm for a specified number of generations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_generations : int</span>
<span class="sd">            The number of generations to run the genetic algorithm.</span>
<span class="sd">        population_size : int</span>
<span class="sd">            The number of individuals in the population.</span>
<span class="sd">        init_genes : list, optional</span>
<span class="sd">            Initial gene values to seed the population. If None, the population is initialized randomly.</span>
<span class="sd">        fitness_threshold : float, optional</span>
<span class="sd">            The fitness threshold to stop the algorithm early. If None, the algorithm runs for `n_generations`.</span>
<span class="sd">        verbosity : int, optional</span>
<span class="sd">            The verbosity level for printing messages. 0 = silent, 1 = normal output, 2 = detailed output (default is 1).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of list of Individual</span>
<span class="sd">            A list containing the population at each generation.</span>
<span class="sd">            Each population is a list of `Individual` objects.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="c1"># Start multiprocessing pool if specified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_pool</span><span class="p">()</span>
        <span class="c1"># Create initial population</span>
        <span class="n">population</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_initial_population</span><span class="p">(</span><span class="n">population_size</span><span class="p">,</span> <span class="n">init_genes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">population</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Failed to create initial population.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Set the values for r0 for diversity enhanced selection</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">survivor_selection</span><span class="p">,</span> <span class="n">DiversityEnhancedSurvivorSelection</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">survivor_selection</span><span class="o">.</span><span class="n">r0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>                        
            <span class="c1"># Compute the average measure between two individuals, including only non-zero distances</span>
            <span class="n">initial_population_distances</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">survivor_selection</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">get_gene_values</span><span class="p">(),</span> <span class="n">p2</span><span class="o">.</span><span class="n">get_gene_values</span><span class="p">())</span> <span class="k">for</span> <span class="n">p1</span> <span class="ow">in</span> <span class="n">population</span> <span class="k">for</span> <span class="n">p2</span> <span class="ow">in</span> <span class="n">population</span><span class="p">]</span>
            <span class="c1"># drop the zeros</span>
            <span class="n">initial_population_distances</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">initial_population_distances</span> <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
            <span class="c1"># get the average distance</span>
            <span class="n">avg_measure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">initial_population_distances</span><span class="p">)</span>
            <span class="c1"># set r0</span>
            <span class="n">avg_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">avg_measure</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">survivor_selection</span><span class="o">.</span><span class="n">r0</span> <span class="o">=</span> <span class="n">avg_distance</span><span class="o">/</span><span class="mi">10</span>
            
        
        <span class="c1"># Determine the generations at which to print the averages</span>
        <span class="n">print_generations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_generations</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1"># Run the genetic algorithm for the specified number of generations</span>

        <span class="n">historical_population</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="n">individual</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">individual</span> <span class="ow">in</span> <span class="n">population</span> <span class="p">]</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">generation</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_generations</span><span class="p">):</span>                
            
            <span class="c1"># Create genes of the offspring</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crossover_method</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
                    <span class="c1"># If no crossover, take the individual directly from the current population and apply mutation. </span>
                    <span class="c1"># Set force_mutate to True to ensure that at least one gene is mutated.</span>
                    <span class="n">offspring_genes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mutation</span><span class="o">.</span><span class="n">mutate_genes</span><span class="p">(</span><span class="n">individual</span><span class="o">.</span><span class="n">get_genes</span><span class="p">(),</span><span class="n">force_mutate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">individual</span> <span class="ow">in</span> <span class="n">population</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Select two parents randomly</span>
                <span class="n">random_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">population_size</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">population_size</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">parents</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">population</span><span class="p">)[</span><span class="n">random_indices</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">population_size</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                
                <span class="c1"># Create genes of the offspring by crossover</span>
                <span class="n">offspring_genes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">crossover_method</span><span class="o">.</span><span class="n">crossover</span><span class="p">(</span><span class="n">parent1</span><span class="o">.</span><span class="n">get_genes</span><span class="p">(),</span> <span class="n">parent2</span><span class="o">.</span><span class="n">get_genes</span><span class="p">())</span> <span class="k">for</span> <span class="n">parent1</span><span class="p">,</span> <span class="n">parent2</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">]</span>

                <span class="c1"># Apply mutation</span>
                <span class="n">offspring_genes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mutation</span><span class="o">.</span><span class="n">mutate_genes</span><span class="p">(</span><span class="n">genes</span><span class="p">)</span> <span class="k">for</span> <span class="n">genes</span> <span class="ow">in</span> <span class="n">offspring_genes</span><span class="p">]</span>

            <span class="c1"># Create offspring Individual objects using multiprocessing if specified</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_multiprocessing</span><span class="p">:</span>
                <span class="n">offspring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">Individual</span><span class="p">,</span> <span class="p">[(</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_function_args</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">offspring_genes</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">offspring</span> <span class="o">=</span> <span class="p">[</span><span class="n">Individual</span><span class="p">(</span><span class="n">genes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_function_args</span><span class="p">)</span> <span class="k">for</span> <span class="n">genes</span> <span class="ow">in</span> <span class="n">offspring_genes</span><span class="p">]</span>

            <span class="c1"># Combine parent and offspring populations (Elitism)</span>
            <span class="n">combined_population</span> <span class="o">=</span> <span class="n">population</span> <span class="o">+</span> <span class="n">offspring</span> 

            <span class="c1"># Select the best individuals to form the next generation</span>
            <span class="n">population</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">survivor_selection</span><span class="o">.</span><span class="n">select_survivors</span><span class="p">(</span><span class="n">combined_population</span><span class="p">,</span> <span class="n">population_size</span><span class="p">)</span>

            <span class="n">best_fitness</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span> <span class="p">[</span><span class="n">individual</span><span class="o">.</span><span class="n">fitness</span> <span class="k">for</span> <span class="n">individual</span> <span class="ow">in</span> <span class="n">population</span><span class="p">])</span>
            <span class="n">average_fitness</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">individual</span><span class="o">.</span><span class="n">fitness</span> <span class="k">for</span> <span class="n">individual</span> <span class="ow">in</span> <span class="n">population</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">generation</span> <span class="ow">in</span> <span class="n">print_generations</span> <span class="ow">or</span> <span class="n">generation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generation </span><span class="si">{</span><span class="n">generation</span><span class="si">}</span><span class="s2">, Average Fitness: </span><span class="si">{</span><span class="n">average_fitness</span><span class="si">}</span><span class="s2">, Best Fitness: </span><span class="si">{</span><span class="n">best_fitness</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">historical_population</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="n">individual</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">individual</span> <span class="ow">in</span> <span class="n">population</span> <span class="p">]</span> <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitness_file</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">generation</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">average_fitness</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">best_fitness</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># Save the genes of the historical population to the output file.</span>
                <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">survivors_file</span><span class="p">,</span> <span class="p">[</span> <span class="p">[</span><span class="n">individual</span><span class="o">.</span><span class="n">get_gene_values</span><span class="p">()</span> <span class="k">for</span> <span class="n">individual</span> <span class="ow">in</span> <span class="n">population</span><span class="p">]</span> <span class="k">for</span> <span class="n">population</span> <span class="ow">in</span> <span class="n">historical_population</span> <span class="p">])</span>

            <span class="c1"># Check if fitness threshold is reached</span>
            <span class="k">if</span> <span class="n">fitness_threshold</span> <span class="ow">and</span> <span class="n">best_fitness</span> <span class="o">&gt;=</span> <span class="n">fitness_threshold</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fitness threshold reached at generation </span><span class="si">{</span><span class="n">generation</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="c1"># Stop multiprocessing pool if specified    </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_pool</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">historical_population</span></div>


<div class="viewcode-block" id="GeneticAlgorithm.run_light">
<a class="viewcode-back" href="../../lightweight_genetic_algorithm.html#lightweight_genetic_algorithm.algorithm.GeneticAlgorithm.run_light">[docs]</a>
    <span class="k">def</span> <span class="nf">run_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_generations</span><span class="p">,</span> <span class="n">population_size</span><span class="p">,</span> <span class="n">init_genes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fitness_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Runs the genetic algorithm and returns only the gene values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_generations : int</span>
<span class="sd">            The number of generations to run the genetic algorithm.</span>
<span class="sd">        population_size : int</span>
<span class="sd">            The number of individuals in the population.</span>
<span class="sd">        init_genes : list, optional</span>
<span class="sd">            Initial gene values to seed the population. If None, the population is initialized randomly.</span>
<span class="sd">        fitness_threshold : float, optional</span>
<span class="sd">            The fitness threshold to stop the algorithm early. If None, the algorithm runs for `n_generations`.</span>
<span class="sd">        verbosity : int, optional</span>
<span class="sd">            The verbosity level for printing messages. 0 = silent, 1 = normal output, 2 = detailed output (default is 1).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of list</span>
<span class="sd">            A list containing the gene values of the population at each generation.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">historical_population</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">n_generations</span><span class="p">,</span> <span class="n">population_size</span><span class="p">,</span> <span class="n">init_genes</span><span class="o">=</span><span class="n">init_genes</span><span class="p">,</span> <span class="n">fitness_threshold</span><span class="o">=</span><span class="n">fitness_threshold</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[[</span><span class="n">individual</span><span class="o">.</span><span class="n">get_gene_values</span><span class="p">()</span> <span class="k">for</span> <span class="n">individual</span> <span class="ow">in</span> <span class="n">population</span><span class="p">]</span> <span class="k">for</span> <span class="n">population</span> <span class="ow">in</span> <span class="n">historical_population</span><span class="p">]</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Lightweight Genetic Algorithm</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../lightweight_genetic_algorithm.html">lightweight_genetic_algorithm package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Eliel Camargo-Molina, Jonas Wessén.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>