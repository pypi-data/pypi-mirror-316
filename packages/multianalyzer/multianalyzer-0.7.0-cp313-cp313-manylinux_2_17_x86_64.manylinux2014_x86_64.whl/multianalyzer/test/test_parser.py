__authors__ = ["J. Kieffer"]
__license__ = "MIT"
__date__ = "04/04/2022"

import unittest
import os
from ..file_io import topas_parser
import logging
import tempfile
logger = logging.getLogger(__name__)

out_2021="""
Wavelength = 0.3541804473 (0.0000000053) 
Zero [MA6] =   0.00000000 (  0.00000000) 
    manom       mantth          dh 
 0.05651551  0.11281072        0.5000   (manom =   3.238100  mantth =   6.463578 )
       L1            L2 
     442.5000     238.0351
   centre       rollx      rolly      offset 
  286.3630  0.010565245  0.000000000 -0.209592460    MA0
  287.3468  0.005799983  0.000000000 -0.173620753    MA1
  288.3306  0.008820042  0.000000000 -0.138563058    MA2
  289.3144  0.005117273  0.000000000 -0.106395845    MA3
  290.2981  0.011531870  0.000000000 -0.069589678    MA4
  291.2819  0.013408102  0.000000000 -0.036933813    MA5
  292.2657  0.010356704  0.000000000  0.000000000    MA6
  293.2495  0.005954979  0.000000000  0.035727108    MA7
  294.2332  0.011711911  0.000000000  0.068024080    MA8
  295.2170  0.010718834  0.000000000  0.102703437    MA9
  296.2008  0.004283634  0.000000000  0.139223696    MA10
  297.1846  0.011034291  0.000000000  0.174401308    MA11
  298.1684  0.011214173  0.000000000  0.209697416    MA12
"""
out_2022="""
Wavelength = 0.3542703872 (0.0000000037) 
Zero [MA6] =  -0.00021297 (  0.00000033) 
    manom       mantth          dh        wg  
 0.05651551  0.11344640     1.0000     0.6465   (manom =   3.238100  mantth =   6.500000 )
       L1            L2 
     442.5000     234.3575
   centre       rollx      rolly           offset      scale    
  276.5383  0.010267568  0.000000000   -0.209599262  0.85310623    MA0
  276.5593  0.005536728  0.000000000   -0.173630465  0.92684184    MA1
  276.5804  0.008576358  0.000000000   -0.138578522  0.98552405    MA2
  276.6014  0.004982723  0.000000000   -0.106402421  0.92096280    MA3
  276.6224  0.011307968  0.000000000   -0.069596929  0.96665980    MA4
  276.6434  0.013276234  0.000000000   -0.036941239  1.29657873    MA5
  276.6645  0.010123154  0.000000000    0.000000000  0.96837643    MA6
  276.6855  0.005907272  0.000000000    0.035712305  0.98096055    MA7
  276.7065  0.011540197  0.000000000    0.068019714  0.91586385    MA8
  276.7275  0.010744397  0.000000000    0.102710046  1.04301617    MA9
  276.7485  0.004270040  0.000000000    0.139215345  1.17565487    MA10
  276.7696  0.010894320  0.000000000    0.174392971  0.96075330    MA11
  276.7906  0.011161995  0.000000000    0.209684075  1.00570138    MA12
"""

class TestParse(unittest.TestCase):

    def test_parse_topas(self):
        for data in [out_2021, out_2022]:
            f = tempfile.NamedTemporaryFile(mode='w', delete=False)
            filename = f.name
            f.write(data)
            f.close()
            topas_parser(filename)
            os.unlink(filename)


def suite():
    testSuite = unittest.TestSuite()
    testSuite.addTest(TestParse("test_parse_topas"))
    return testSuite


if __name__ == '__main__':
    runner = unittest.TextTestRunner()
    runner.run(suite())
