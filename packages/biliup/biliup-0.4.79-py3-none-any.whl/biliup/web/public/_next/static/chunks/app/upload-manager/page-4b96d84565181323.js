(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[805],{41010:function(e,t,a){Promise.resolve().then(a.bind(a,48837))},30695:function(e,t,a){"use strict";a.d(t,{_i:function(){return i},gz:function(){return l},hw:function(){return s},sj:function(){return o},wG:function(){return n}});var r=a(20357);async function n(e,t){var a;let{arg:n}=t,i=await fetch((null!==(a=r.env.NEXT_PUBLIC_API_SERVER)&&void 0!==a?a:"")+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!(i.status>=200&&i.status<300))throw Error(await i.text());let o=await i.json();if(!i.ok)throw Error(o.message);return o}let i=async function(){for(var e,t=arguments.length,a=Array(t),n=0;n<t;n++)a[n]=arguments[n];let i=await fetch((null!==(e=r.env.NEXT_PUBLIC_API_SERVER)&&void 0!==e?e:"")+a[0],a[1]);if(!i.ok)throw Error(await i.text());return i.json()},o=async(e,t)=>{var a;let n=await fetch((null!==(a=r.env.NEXT_PUBLIC_API_SERVER)&&void 0!==a?a:"")+e,t);if(!n.ok)throw Error(await n.text());return n};async function s(e,t){var a;let{arg:n}=t,i=await fetch("".concat(null!==(a=r.env.NEXT_PUBLIC_API_SERVER)&&void 0!==a?a:"").concat(e,"/").concat(n),{method:"DELETE"});if(!i.ok)throw Error(await i.text());return i}async function l(e,t){var a;let{arg:n}=t,i=await fetch("".concat(null!==(a=r.env.NEXT_PUBLIC_API_SERVER)&&void 0!==a?a:"").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok)throw Error(await i.text());return i}},12951:function(e,t,a){"use strict";a.d(t,{Bf:function(){return s},JB:function(){return l},ZP:function(){return o}});var r=a(91617),n=a(30695),i=a(2265);function o(){let{data:e,error:t,isLoading:a}=(0,r.ZP)("/v1/streamers",n._i);return{isLoading:a,streamers:e}}function s(){let{data:e,error:t,isLoading:a}=(0,r.ZP)("/v1/users",n._i),[o,s]=(0,i.useState)([]);return(0,i.useEffect)(()=>{if(!e||0===e.length)return;let t=async e=>{try{var t;let a=await (0,n._i)("/bili/space/myinfo?user=".concat(e.value),void 0),r=await (0,n.sj)("/bili/proxy?url=".concat(null===(t=a.data)||void 0===t?void 0:t.face)),i=await r.blob();return{...e,name:a.data.name,face:URL.createObjectURL(i)}}catch(r){console.error(r);let t=await (0,n.sj)("/bili/proxy?url=https://i0.hdslb.com/bfs/face/member/noface.jpg"),a=await t.blob();return{...e,name:"Cookie已失效",face:URL.createObjectURL(a)}}};Promise.all(e.map(t)).then(s)},[e]),{isLoading:a,isError:t,biliUsers:o}}function l(){var e;let{data:t,error:a,isLoading:i}=(0,r.ZP)("/bili/archive/pre",n._i);return{isLoading:i,isError:a,typeTree:null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.typelist.map(e=>({label:e.name,value:e.id,children:e.children}))}}},48837:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return k}});var r=a(57437),n=a(48936),i=a(71834),o=a(44261),s=a(98964),l=a(2265),c=a(87138),d=a(37617),u=a(85080),h=a(88684),m=a(30695),x=a(91617),f=a(16463),g=a(36710),p=a(56164),v=a.n(p),y=e=>{let{abbr:t,label:a,value:i,onRemove:o,url:s}=e;return(0,r.jsxs)("div",{className:v().components,children:[(0,r.jsx)(n.qE,{size:"small",src:s,children:t}),(0,r.jsxs)("div",{className:v().info,children:[(0,r.jsx)("div",{className:v().name,children:a}),(0,r.jsx)("div",{className:v().email,children:i})]}),(0,r.jsx)(n.gn,{title:"确定是否要删除？",content:"此操作将不可逆",onConfirm:o,children:(0,r.jsx)(n.zx,{className:v()["semi-icon-close"],type:"danger",theme:"borderless",icon:(0,r.jsx)(g.Z,{})})})]},a)},j=a(77634),b=a(12951),w=a(57171),_=a(20357),C=e=>{let{onSuccess:t}=e,[a,i]=(0,l.useState)("");return((0,l.useEffect)(()=>{let e=new AbortController,a=e.signal;return a.addEventListener("abort",()=>{console.log("aborted!")}),(async()=>{var e;let r=await (0,m._i)("/v1/get_qrcode",void 0);i(r.data.url),console.log(r.data.url);let n=await fetch("".concat(null!==(e=_.env.NEXT_PUBLIC_API_SERVER)&&void 0!==e?e:"","/v1/login_by_qrcode"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),signal:a});if(!(n.status>=200&&n.status<300))throw Error(await n.text());let o=await n.json();if(!n.ok)throw Error(o.message);t(o.filename)})().catch(e=>{console.log(e),n.P_.error({title:"QRcode",content:(0,r.jsx)(n.Typography.Paragraph,{style:{maxWidth:450},children:e.message}),style:{width:"min-content"}})}),()=>{e.abort("qrcode exit")}},[t]),""===a)?(0,r.jsx)(n.yC,{}):(0,r.jsx)("div",{style:{marginTop:30,marginLeft:"auto",marginRight:"auto",width:"max-content"},children:(0,r.jsx)(w.tv,{value:a})})},E=e=>{let{onCancel:t,visible:a}=e,{trigger:i}=(0,j.Z)("/v1/users",m.wG),{trigger:o}=(0,j.Z)("/v1/users",m.hw),{biliUsers:c}=(0,b.Bf)(),[d,u]=(0,l.useState)(!1),[h,x]=(0,l.useState)(!1),f=async e=>{x(!0);try{let t=await (0,m._i)("/bili/space/myinfo?user=".concat(e),void 0);if(t.code)throw Error(t.message);await i({id:0,name:e,value:e,platform:"bilibili-cookies"}),u(!1),n.FN.success("创建成功")}catch(t){let e=t.message;try{e=JSON.parse(e).error}catch(e){console.log(e)}return n.P_.error({title:"创建失败",content:(0,r.jsx)(n.Typography.Paragraph,{style:{maxWidth:450},children:e}),style:{width:"min-content"}})}finally{x(!1)}},g=async()=>{var e;let t=await (null===(e=v.current)||void 0===e?void 0:e.validate());await f(null==t?void 0:t.value)},p=async e=>{try{await o(e),n.FN.success("删除成功")}catch(e){n.P_.error({title:"删除失败",content:(0,r.jsx)(n.Typography.Paragraph,{style:{maxWidth:450},children:e.message}),style:{width:"min-content"}})}},v=(0,l.useRef)(),[w,_]=(0,l.useState)(),[E,k]=(0,l.useState)((0,r.jsx)(r.Fragment,{}));return(0,r.jsxs)(n.Uu,{title:(0,r.jsx)(n.Typography.Title,{heading:4,children:"用户管理"}),visible:a,footer:(0,r.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,r.jsx)(n.zx,{onClick:()=>{u(!0)},icon:(0,r.jsx)(s.Z,{size:"large"}),style:{marginRight:4,backgroundColor:"rgba(var(--semi-indigo-0), 1)"},children:"新增"})}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},onCancel:t,children:[(0,r.jsx)(n.aV,{className:"component-list-demo-booklist",dataSource:c,split:!1,size:"small",style:{flexBasis:"100%",flexShrink:0},renderItem:e=>(0,r.jsx)(y,{url:e.face,abbr:e.name,label:e.name,value:e.value,onRemove:async()=>await p(e.id)})}),(0,r.jsxs)(n.u_,{title:"新建",visible:d,onOk:g,afterClose:()=>{console.log("After Close callback executed")},onCancel:()=>{u(!1),console.log("Cancel button clicked")},closeOnEsc:!0,confirmLoading:h,okButtonProps:{disabled:2===w},bodyStyle:{overflow:"auto",maxHeight:"calc(100vh - 320px)",paddingLeft:10,paddingRight:10},children:[(0,r.jsx)(n.X2,{type:"flex",justify:"center",children:(0,r.jsxs)(n.FX,{type:"button",buttonSize:"large",onChange:e=>{_(e.target.value),2===e.target.value&&k((0,r.jsx)(C,{onSuccess:f})),1===e.target.value&&k((0,r.jsx)(n.Form,{getFormApi:e=>v.current=e,children:(0,r.jsx)(n.Form.Input,{field:"value",label:"Cookie路径",trigger:"blur",placeholder:"cookies.json",rules:[{required:!0}]})}))},value:w,children:[(0,r.jsx)(n.Y8,{value:1,children:"cookie文件"}),(0,r.jsx)(n.Y8,{value:2,children:"扫码登录"})]})}),(0,r.jsx)(n.X2,{children:E})]})]})};function k(){let{Meta:e}=n.Card,{Paragraph:t,Title:a,Text:g}=n.Typography,{Header:p,Content:v}=n.Layout,[y,w]=(0,l.useState)(!1),_=(0,f.useRouter)(),{trigger:C}=(0,j.Z)("/v1/upload/streamers",m.hw),{data:k,error:S,isLoading:P}=(0,x.ZP)("/v1/upload/streamers",m._i),{biliUsers:R}=(0,b.Bf)(),T=()=>{w(!y)},N=async e=>{await C(e)},[I,A]=(0,l.useState)(!1),[L,Z]=(0,l.useState)([]),[z,O]=(0,l.useState)(),B=e=>{O(e),A(!0)},U=async()=>{await (0,m.wG)("/v1/uploads",{arg:{files:L,params:z}}),A(!1)},{data:X}=(0,x.ZP)("/v1/videos",m._i),F=null==X?void 0:X.map(e=>({label:e.name,value:e.name,disabled:!1,key:e.key}));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(E,{visible:y,onCancel:T}),(0,r.jsx)(n.u_,{size:"medium",title:"文件选择",okText:"上传",visible:I,onOk:U,afterClose:()=>{console.log("After Close callback executed")},onCancel:()=>{A(!1),console.log("Cancel button clicked")},closeOnEsc:!0,children:(0,r.jsx)(n.FE,{style:{width:568,height:416},dataSource:F,draggable:!0,onChange:(e,t)=>Z(e)})}),(0,r.jsx)(p,{style:{backgroundColor:"var(--semi-color-bg-1)"},children:(0,r.jsxs)("nav",{style:{display:"flex",paddingLeft:"25px",paddingRight:"25px",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",boxShadow:"0 1px 2px 0 rgb(0 0 0 / 0.05)"},children:[(0,r.jsxs)("div",{style:{display:"flex",gap:10,justifyContent:"center",alignItems:"center",flexWrap:"wrap"},children:[(0,r.jsx)(i.Z,{style:{backgroundColor:"rgba(var(--semi-violet-4), 1)",borderRadius:"var(--semi-border-radius-large)",color:"var(--semi-color-bg-0)",padding:"6px"},size:"large"}),(0,r.jsx)("h4",{children:"投稿管理"})]}),(0,r.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center",gap:6},children:[(0,r.jsx)(n.zx,{onClick:T,type:"tertiary",icon:(0,r.jsx)(o.Z,{}),style:{borderRadius:"var(--semi-border-radius-circle)",marginRight:"12px"}}),(0,r.jsx)(c.default,{href:"/upload-manager/add",onClick:e=>{0===R.length&&(e.preventDefault(),T(),n.P_.info({title:"用户列表为空",position:"top",content:"请先在右侧点击新增用户",duration:3}))},children:(0,r.jsx)(n.zx,{icon:(0,r.jsx)(s.Z,{}),theme:"solid",style:{marginRight:10},children:"新建"})})]})]})}),(0,r.jsx)(v,{style:{padding:"24px",backgroundColor:"var(--semi-color-bg-0)"},children:(0,r.jsx)(n.aV,{grid:{gutter:12,xs:24,sm:24,md:12,lg:8,xl:6,xxl:4},dataSource:k,renderItem:t=>(0,r.jsx)(n.aV.Item,{children:(0,r.jsxs)(n.Card,{shadows:"hover",style:{maxWidth:360,margin:"8px 2px",flexGrow:1},bodyStyle:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsx)(e,{title:(0,r.jsx)(g,{ellipsis:{showTooltip:!0,pos:"middle"},style:{maxWidth:150},children:t.template_name})}),(0,r.jsxs)(n.hE,{style:{minWidth:100},theme:"borderless",children:[(0,r.jsx)(n.zx,{icon:(0,r.jsx)(d.Z,{}),onClick:()=>B(t)}),(0,r.jsx)(n.zx,{icon:(0,r.jsx)(u.Z,{}),onClick:()=>{_.push("/upload-manager/edit?id=".concat(t.id))}}),(0,r.jsx)(n.gn,{title:"确定是否要删除？",content:"此操作将不可逆",margin:50,onConfirm:async()=>await N(t.id),children:(0,r.jsx)(n.zx,{theme:"borderless",icon:(0,r.jsx)(h.Z,{})})})]})]})})})})]})}},56164:function(e){e.exports={components:"AvatarCard_components__heTwn","semi-icon-close":"AvatarCard_semi-icon-close__9hwya",info:"AvatarCard_info__Gzwh8",name:"AvatarCard_name__mOADG",email:"AvatarCard_email__ncXyR"}}},function(e){e.O(0,[798,674,86,949,753,293,406,862,954,936,617,781,589,425,971,23,744],function(){return e(e.s=41010)}),_N_E=e.O()}]);